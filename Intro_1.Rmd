---
title: "Objetos espaciales en R"
author: 
- name:  Susy Echeverría-Londoño 
  affiliation: Investigadora asociada, Imperial College London

#date: "October 27, 2019"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    toc_depth: 2
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Pre-requisitos e instalación de paquetes

Lista de paquetes espaciales en R [https://cran.r-project.org/web/views/Spatial.html](https://cran.r-project.org/web/views/Spatial.html)

```{r cars, eval=FALSE, include=TRUE, echo=TRUE}
install.packages(c("rgdal","rgeos", "maptools", "raster", "sp", "sf"))
```
Paquetes generales: 

 * maptools: manipulación de datos geográficos
 * raster: Lectura, escritura, manipulación, análisis y modelamiento de datos espaciales en cuadrículas. 
 * sp: clases y métodos de datos espaciales (Pebesma & Bivand, 2018). 
 * rgdal: provee enlaces a la libreria geoespacial GDAL y acceso a las operaciones de proyección y transformación de la libreria PROJ4 (Bivand et al., 2017). 
 * sf: combinación estandarizada de funciones en sp, rgeos y rgdal para la manipulación de datos espaciales vectorizados  (Pebesma, 2017)
 

## Organización y creación de proyectos en R

[Guide to reproducible code (British Ecology Society)](https://www.britishecologicalsociety.org/wp-content/uploads/2017/12/guide-to-reproducible-code.pdf)

1. Crear un nuevo projecto en R
2. Crear carpetas básicas (e.g., ./data, ./figs, ./functions, ...)

``` 
└── my_awesome_project
    ├── src
    ├── output
    ├── data
    │   ├── raw
    │   └── processed
    ├── README.md
    ├── run_analyses.R 
    └── .gitignore

``` 
Fuente: https://www.r-bloggers.com/structuring-r-projects/

![](./figs/Folder_structure.png)

# Representación simple de datos espaciales

## Tipos básicos de R

* Números ``` 1 or 2 or 4000 or 10e9... ```
* Cadenas (or characters) ``` "Hola mundo" ```
* Operadores lógicos ``` "TRUE" or "FALSE" ```
* Factores ``` factor("2") factor("segundo") ```
* Vectores ``` c(1, 2) or c("Hola mundo", "como estas") ```
* Matrices

```{r}
matrix(data = c(c(1,2), c("Hola mundo", "Como estas")), nrow = 2, ncol = 2) 
```

* Data frames

```{r}
data.frame(Num = c(1,2), Exp = c("Hola mundo", "Como estas"))
```

## Puntos geográficos

```{r}

x <- c(-73)
y <- c(7.13)

## Colombia continental
## Punta gallinas (lat= 12.46, lon = -71.67)
## Isla San José, Rio Negro Guainia Colombia (1.34, -66.7)
## Cabo Manglares (1.65, -79.01)
## Leticia (-4.23, -69.95)
plot(x, y, xlim = c(-79.01, -66.7), ylim = c(-4.23, 12.46))
abline(h = 4.71, v = -74.07)
```

```{r}
## Quibdo 5.69, -76.65 (max 851.7 mm)
## Medellin 6.24, -75.76 (226.7 mm)
## Bogota 4.71, -74.07 (119 mm)
## Bucaramanga 7.13, -73 (149 mm)
lat = c(-76.65, -75.76, -74.07, -73)
lon = c(5.69, 6.24, 4.71, 7.13)
ciudades = cbind(lat, lon)
precip = c(852, 227, 119, 149)

psize <- 1 + precip/500
plot(ciudades, cex=psize, pch=20, col='red', main='Precipitación', xlim = c(-79.01, -66.7), ylim = c(-4.23, 12.46))
```

https://rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf

```{r}
library(tidyverse)
ciudades2 <- data.frame(x = lon, y = lon, precip = precip)

ciudades2 %>% 
ggplot(aes(x = lat, y = lon)) +
  geom_point(size = 1 + precip/500) +
  xlim(c(-79.01, -66.7)) +
  ylim(c(-4.23, 12.46))
  
```

### Usando el paquete "sf"

```{r}
library(sf)

## Quibdo 5.69, -76.65 (max 851.7 mm)
## Medellin 6.24, -75.76 (226.7 mm)
## Bogota 4.71, -74.07 (119 mm)
## Bucaramanga 7.13, -73 (149 mm)

# Coleccion de rasgos simples (Simple features collection, sfc)
# Crear varios sf
p1 <- st_point(c(5.69, -76.65))
p2 <- st_point(c(6.24,  -75.76))
p3 <- st_point(c(4.71, -74.07))
p4 <- st_point(c(7.13, -73))

# Juntar varios puntos en un sfc 
ciudades_points <- st_sfc(p1, p2, p3, p4, crs = 4326)

ciudades_info <- data.frame(num = 1:nrow(ciudades2), nombre = c("Quibdo", "Medellin", "Bogota", "Bucaramanga"), precip = ciudades2$precip)

ciudades_geo <- st_sf(ciudades_info, geometry = ciudades_points)
```


```{r}
plot(ciudades_geo, axes = TRUE)
```


```{r}
plot(st_geometry(ciudades_geo), axes = TRUE)
plot(ciudades_geo["precip"], axes = TRUE, pwd = 16)

```

```{r}
ciudades_geo[ciudades_geo$nombre == "Quibdo",]

plot(st_geometry(ciudades_geo[ciudades_geo$nombre == "Quibdo" | ciudades_geo$nombre == "Medellin" ,]))

ciudades_geo %>% 
  filter(nombre == "Quibdo" | nombre == "Medellin") %>% 
  st_geometry() %>% 
  plot()
```

```{r}
library(mapview)

mapview(ciudades_geo["nombre"])
mapview(ciudades_geo["precip"])

```


### Lineas 
### Polígonos

## Rasters 

- Datos espaciales en cuadrículas ("gridded data")


## Vectores

### Puntos geográficos
### Lineas 
### Polígonos




# Objetos espaciales en R
## Datos vectoriales
## Datos raster
